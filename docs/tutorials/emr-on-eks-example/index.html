<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300..800&display=swap" rel=stylesheet><link rel=stylesheet href=https://aws-controllers-k8s.github.io/community/main.14073bc830418c0ded0e216904aa12ebe031ea7f6e4eae9ea7eea2f157590b4a8253c6fd6577d31fcdbfd811690dc6644f70e47688753317bc182ac04b0df2d8.css integrity="sha512-FAc7yDBBjA3tDiFpBKoS6+Ax6n9uTq6ep+6i8VdZC0qCU8b9ZXfTH82/2BFpDcZkT3Dkdoh1Mxe8GCrASw3y2A==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Run Spark jobs using the ACK EMR on EKS controller - ACK</title><meta name=description content="ACK service controller for EMR on EKS enables customers to run spark jobs on EKS clusters"><link rel=canonical href=https://aws-controllers-k8s.github.io/community/docs/tutorials/emr-on-eks-example/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Run Spark jobs using the ACK EMR on EKS controller"><meta property="og:description" content="ACK service controller for EMR on EKS enables customers to run spark jobs on EKS clusters"><meta property="og:url" content="https://aws-controllers-k8s.github.io/community/docs/tutorials/emr-on-eks-example/"><meta property="og:site_name" content="ACK"><meta property="og:image" content="https://aws-controllers-k8s.github.io/community/og.png"><meta property="og:image:alt" content="ACK"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@awscloud"><meta name=twitter:creator content><meta name=twitter:title content="Run Spark jobs using the ACK EMR on EKS controller"><meta name=twitter:description content="ACK service controller for EMR on EKS enables customers to run spark jobs on EKS clusters"><meta name=twitter:image content="https://aws-controllers-k8s.github.io/community/og.png"><meta name=twitter:image:alt content="Run Spark jobs using the ACK EMR on EKS controller"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://aws-controllers-k8s.github.io/#/schema/organization/1","name":"AWS Controllers for K8s","url":"https://aws-controllers-k8s.github.io/","sameAs":["https://twitter.com/awscloud","https://github.com/aws-controllers-k8s/community"],"logo":{"@type":"ImageObject","@id":"https://aws-controllers-k8s.github.io/#/schema/image/1","url":"https://aws-controllers-k8s.github.io/ack.png","width":512,"height":512,"caption":"AWS Controllers for K8s"},"image":{"@id":"https://aws-controllers-k8s.github.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://aws-controllers-k8s.github.io/#/schema/website/1","url":"https://aws-controllers-k8s.github.io/","name":"ACK","description":"Doks is a Hugo theme helping you build modern documentation websites that are secure, fast, and SEO-ready — by default.","publisher":{"@id":"https://aws-controllers-k8s.github.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://aws-controllers-k8s.github.io/community/docs/tutorials/emr-on-eks-example/","url":"https://aws-controllers-k8s.github.io/community/docs/tutorials/emr-on-eks-example/","name":"Run Spark jobs using the ACK EMR on EKS controller","description":"ACK service controller for EMR on EKS enables customers to run spark jobs on EKS clusters","isPartOf":{"@id":"https://aws-controllers-k8s.github.io/#/schema/website/1"},"about":{"@id":"https://aws-controllers-k8s.github.io/#/schema/organization/1"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","breadcrumb":{"@id":"https://aws-controllers-k8s.github.io/community/docs/tutorials/emr-on-eks-example/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://aws-controllers-k8s.github.io/community/docs/tutorials/emr-on-eks-example/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://aws-controllers-k8s.github.io/community/docs/tutorials/emr-on-eks-example/"]}]},{"@type":"BreadcrumbList","@id":"https://aws-controllers-k8s.github.io/community/docs/tutorials/emr-on-eks-example/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://aws-controllers-k8s.github.io/community/","url":"https://aws-controllers-k8s.github.io/community/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://aws-controllers-k8s.github.io/community/docs/","url":"https://aws-controllers-k8s.github.io/community/docs/","name":"Docs"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://aws-controllers-k8s.github.io/community/docs/tutorials/","url":"https://aws-controllers-k8s.github.io/community/docs/tutorials/","name":"Tutorials"}},{"@type":"ListItem","position":4,"item":{"@id":"https://aws-controllers-k8s.github.io/community/docs/tutorials/emr-on-eks-example/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://aws-controllers-k8s.github.io/#/schema/article/1","headline":"Run Spark jobs using the ACK EMR on EKS controller","description":"ACK service controller for EMR on EKS enables customers to run spark jobs on EKS clusters","isPartOf":{"@id":"https://aws-controllers-k8s.github.io/community/docs/tutorials/emr-on-eks-example/"},"mainEntityOfPage":{"@id":"https://aws-controllers-k8s.github.io/community/docs/tutorials/emr-on-eks-example/"},"datePublished":"0001-01-01T00:00:00CET","dateModified":"0001-01-01T00:00:00CET","author":{"@id":"https://aws-controllers-k8s.github.io/#/schema/person/2"},"publisher":{"@id":"https://aws-controllers-k8s.github.io/#/schema/organization/1"},"image":{"@id":"https://aws-controllers-k8s.github.io/community/docs/tutorials/emr-on-eks-example/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://aws-controllers-k8s.github.io/#/schema/person/2","name":"AWS","sameAs":["https://twitter.com/awscloud","https://github.com/aws-controllers-k8s"]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://aws-controllers-k8s.github.io/community/docs/tutorials/emr-on-eks-example/#/schema/image/2","url":"https://aws-controllers-k8s.github.io/community/og.png","contentUrl":"https://aws-controllers-k8s.github.io/community/og.png","caption":"Run Spark jobs using the ACK EMR on EKS controller"}]}]}</script><meta name=theme-color content="#ff9900"><link rel=apple-touch-icon sizes=180x180 href=https://aws-controllers-k8s.github.io/community/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://aws-controllers-k8s.github.io/community/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://aws-controllers-k8s.github.io/community/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://aws-controllers-k8s.github.io/community/site.webmanifest><link rel=mask-icon color=#5bbad5 href=https://aws-controllers-k8s.github.io/community/safari-pinned-tab.svg><meta name=msapplication-TileColor content="#da532c"><script>(()=>{var b=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,a=localStorage.getItem("theme");b&&a===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),b&&a==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),a==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body class="docs single d-flex flex-column h-100 dark"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label>
<a class="navbar-brand order-1 order-md-0 me-auto" href=https://aws-controllers-k8s.github.io/community/><span class="navbar-logo logo-light"><svg width="30" height="34" viewBox="0 0 64.386 62.635" xmlns="http://www.w3.org/2000/svg"><path d="m18.112 62.241c-.58208-.2097-1.0825-.38307-1.1121-.38526-.05964-.004-6.9703-8.5523-8.016-9.9151-.3638-.47411-1.8521-2.3244-3.3073-4.1118-6.169-7.5771-5.7671-6.894-5.6043-9.525.07652-1.2369.2681-2.6062.42574-3.0427.15763-.43656.88408-3.4726 1.6143-6.7469s1.4423-6.4294 1.5822-7.0115c.13998-.58209.49521-2.1299.78941-3.4396 1.3414-5.9718 1.3876-6.0514 4.3737-7.5406 1.313-.65484 3.9324-1.927 5.8208-2.8269 1.8885-.89995 6.3475-3.0258 9.9091-4.7242 7.7798-3.7099 7.4615-3.6736 12.178-1.3871 1.6735.81137 4.531 2.1853 6.35 3.0532 1.819.86788 4.4384 2.1189 5.8208 2.78 1.3824.66112 3.7644 1.7868 5.2931 2.5015 2.9983 1.4017 4.0296 2.3189 4.4852 3.9889.24392.89408.61395 2.4653 2.1314 9.0501.28504 1.2369.86914 3.7372 1.298 5.5562s.97374 4.2003 1.2108 5.2917c.2371 1.0914.56563 2.4425.73006 3.0024.50213 1.7098.37232 3.363-.34938 4.4494-.35422.53325-2.549 3.3137-4.8774 6.1788-2.3283 2.8651-4.531 5.6016-4.8948 6.0813-3.5052 4.6213-6.5923 8.1362-7.558 8.6052-1.0278.49922-1.6581.52197-14.155.51087-10.7-.01-13.272-.081-14.138-.39289zm14.42-14.853c1.993-.65861 4.1321-1.8055 5.208-2.7923l.57777-.52995.15829 1.0218c.37804 2.4404.25325 2.3447 3.0582 2.3447h2.5072v-12.965c0-14.742.01357-14.637-2.1954-17.096-2.2207-2.4725-5.3026-3.3183-11.157-3.0616-3.7392.16395-6.9101.77913-9.2875 1.8019l-1.3054.56157v2.2164c0 1.219.0817 2.2164.18156 2.2164s1.0226-.23473 2.0505-.52163c2.4182-.67492 6.8343-1.3304 8.9629-1.3304 2.0099.0 4.3168.63112 5.1681 1.4139 1.22 1.1218 1.459 1.9649 1.5795 5.5722.10844 3.2453.08971 3.4049-.37858 3.2252-.27096-.10398-1.6251-.35976-3.0091-.56841-6.4942-.979-10.999.005-14.067 3.0735-2.0011 2.0011-2.4548 3.2402-2.4641 6.7305-.0065 2.4258.08634 3.1141.55768 4.1334 1.179 2.5499 3.2925 4.2534 5.9416 4.9794 2.3169.63499 5.0434.52227 7.9127-.42589zm-5.3603-4.4174c-1.3419-.50246-1.7811-.90498-2.3487-2.1529-.96238-2.1156-.37837-5.1724 1.2299-6.4375 1.6643-1.3091 6.0181-1.7402 10.183-1.0084l1.7198.30217v6.6092l-1.4496.86623c-3.1522 1.8836-7.1071 2.6552-9.3347 1.8212z" stroke-width=".26458" style="fill:#212529"/><path style="fill:none;stroke-width:.271169" d="m97.026736 181.42372c-11.841729-2.08439-21.332462-9.10215-26.093859-19.29466-1.998022-4.27707-2.054194-4.6839-2.055098-14.88419-841e-6-9.49243.144169-11.16725 1.267846-14.64314 1.712817-5.29828 6.177554-10.936 12.299033-15.53024 2.542552-1.90822 7.390509-4.53026 10.594967-5.73033 8.933335-3.34556 20.674605-4.18152 34.409895-2.44995 4.41785.55695 12.65266 1.97363 14.19738 2.44244 1.76241.53489 1.85502.50959 2.22367-.60744.24279-.73566.28029-2.73516.14369-7.66053-.44788-16.149002-1.23751-19.911778-5.02917-23.965076-1.80821-1.932978-3.56225-2.973051-7.11557-4.219231-5.30124-1.859191-12.26098-2.569875-19.19872-1.960452-10.49153.921594-19.993865 2.573896-30.430988 5.291456l-5.619006 1.463045-.198978-.992725C76.31239 78.136699 76.217381 74.401849 76.210696 70.38303l-.01215-7.306943 3.356503-1.444983c10.517529-4.527823 21.216871-6.656502 37.293351-7.419665 12.51101-.593907 22.76653.582675 29.54824 3.389974 4.64166 1.921419 7.46417 3.920688 11.49419 8.14168 5.92808 6.208991 7.10885 9.292714 7.94906 20.759878.20234 2.761617.35353 19.385439.44083 48.471489l.13286 44.26837-6.87266-.008c-7.35796-.009-10.40797-.26157-11.45694-.94889-1.06894-.70039-1.56607-2.17132-2.37024-7.01314-.41845-2.51943-.81979-4.63975-.89185-4.71182-.0721-.0721-.94053.61073-1.92991 1.51732-2.61666 2.39769-6.17638 4.67392-11.10375 7.10019-7.00303 3.44832-13.15672 5.41292-19.90153 6.35366-4.14851.57862-11.25229.52696-14.85996-.10807zM117.9586 163.14859c7.66738-1.41157 14.24402-3.97835 21.89691-8.5461l3.72858-2.22546v-12.58107c0-11.74762-.0314-12.59038-.47455-12.72168-1.42309-.42168-10.77757-1.80215-14.1221-2.08405-4.68265-.39467-14.28993-.18758-17.80807.38387-8.70887 1.41459-13.028171 3.55254-15.811026 7.82606-2.230704 3.42561-3.30745 7.4555-3.304504 12.36763.0032 5.38208 1.685615 10.33001 4.555689 13.39835 1.872987 2.00238 6.082191 3.96008 9.779001 4.54822 2.10281.33454 8.92935.11855 11.56007-.36577z" transform="scale(0.26458333)"/></svg></span><span class="navbar-logo logo-dark d-none"><svg width="30" height="34" viewBox="0 0 64.386 62.635" xmlns="http://www.w3.org/2000/svg"><path d="m18.112 62.241c-.58208-.2097-1.0825-.38307-1.1121-.38526-.05964-.004-6.9703-8.5523-8.016-9.9151-.3638-.47411-1.8521-2.3244-3.3073-4.1118-6.169-7.5771-5.7671-6.894-5.6043-9.525.07652-1.2369.2681-2.6062.42574-3.0427.15763-.43656.88408-3.4726 1.6143-6.7469s1.4423-6.4294 1.5822-7.0115c.13998-.58209.49521-2.1299.78941-3.4396 1.3414-5.9718 1.3876-6.0514 4.3737-7.5406 1.313-.65484 3.9324-1.927 5.8208-2.8269 1.8885-.89995 6.3475-3.0258 9.9091-4.7242 7.7798-3.7099 7.4615-3.6736 12.178-1.3871 1.6735.81137 4.531 2.1853 6.35 3.0532 1.819.86788 4.4384 2.1189 5.8208 2.78 1.3824.66112 3.7644 1.7868 5.2931 2.5015 2.9983 1.4017 4.0296 2.3189 4.4852 3.9889.24392.89408.61395 2.4653 2.1314 9.0501.28504 1.2369.86914 3.7372 1.298 5.5562s.97374 4.2003 1.2108 5.2917c.2371 1.0914.56563 2.4425.73006 3.0024.50213 1.7098.37232 3.363-.34938 4.4494-.35422.53325-2.549 3.3137-4.8774 6.1788-2.3283 2.8651-4.531 5.6016-4.8948 6.0813-3.5052 4.6213-6.5923 8.1362-7.558 8.6052-1.0278.49922-1.6581.52197-14.155.51087-10.7-.01-13.272-.081-14.138-.39289zm14.42-14.853c1.993-.65861 4.1321-1.8055 5.208-2.7923l.57777-.52995.15829 1.0218c.37804 2.4404.25325 2.3447 3.0582 2.3447h2.5072v-12.965c0-14.742.01357-14.637-2.1954-17.096-2.2207-2.4725-5.3026-3.3183-11.157-3.0616-3.7392.16395-6.9101.77913-9.2875 1.8019l-1.3054.56157v2.2164c0 1.219.0817 2.2164.18156 2.2164s1.0226-.23473 2.0505-.52163c2.4182-.67492 6.8343-1.3304 8.9629-1.3304 2.0099.0 4.3168.63112 5.1681 1.4139 1.22 1.1218 1.459 1.9649 1.5795 5.5722.10844 3.2453.08971 3.4049-.37858 3.2252-.27096-.10398-1.6251-.35976-3.0091-.56841-6.4942-.979-10.999.005-14.067 3.0735-2.0011 2.0011-2.4548 3.2402-2.4641 6.7305-.0065 2.4258.08634 3.1141.55768 4.1334 1.179 2.5499 3.2925 4.2534 5.9416 4.9794 2.3169.63499 5.0434.52227 7.9127-.42589zm-5.3603-4.4174c-1.3419-.50246-1.7811-.90498-2.3487-2.1529-.96238-2.1156-.37837-5.1724 1.2299-6.4375 1.6643-1.3091 6.0181-1.7402 10.183-1.0084l1.7198.30217v6.6092l-1.4496.86623c-3.1522 1.8836-7.1071 2.6552-9.3347 1.8212z" stroke-width=".26458" style="fill:#fff"/><path style="fill:none;stroke-width:.271169" d="m97.026736 181.42372c-11.841729-2.08439-21.332462-9.10215-26.093859-19.29466-1.998022-4.27707-2.054194-4.6839-2.055098-14.88419-841e-6-9.49243.144169-11.16725 1.267846-14.64314 1.712817-5.29828 6.177554-10.936 12.299033-15.53024 2.542552-1.90822 7.390509-4.53026 10.594967-5.73033 8.933335-3.34556 20.674605-4.18152 34.409895-2.44995 4.41785.55695 12.65266 1.97363 14.19738 2.44244 1.76241.53489 1.85502.50959 2.22367-.60744.24279-.73566.28029-2.73516.14369-7.66053-.44788-16.149002-1.23751-19.911778-5.02917-23.965076-1.80821-1.932978-3.56225-2.973051-7.11557-4.219231-5.30124-1.859191-12.26098-2.569875-19.19872-1.960452-10.49153.921594-19.993865 2.573896-30.430988 5.291456l-5.619006 1.463045-.198978-.992725C76.31239 78.136699 76.217381 74.401849 76.210696 70.38303l-.01215-7.306943 3.356503-1.444983c10.517529-4.527823 21.216871-6.656502 37.293351-7.419665 12.51101-.593907 22.76653.582675 29.54824 3.389974 4.64166 1.921419 7.46417 3.920688 11.49419 8.14168 5.92808 6.208991 7.10885 9.292714 7.94906 20.759878.20234 2.761617.35353 19.385439.44083 48.471489l.13286 44.26837-6.87266-.008c-7.35796-.009-10.40797-.26157-11.45694-.94889-1.06894-.70039-1.56607-2.17132-2.37024-7.01314-.41845-2.51943-.81979-4.63975-.89185-4.71182-.0721-.0721-.94053.61073-1.92991 1.51732-2.61666 2.39769-6.17638 4.67392-11.10375 7.10019-7.00303 3.44832-13.15672 5.41292-19.90153 6.35366-4.14851.57862-11.25229.52696-14.85996-.10807zM117.9586 163.14859c7.66738-1.41157 14.24402-3.97835 21.89691-8.5461l3.72858-2.22546v-12.58107c0-11.74762-.0314-12.59038-.47455-12.72168-1.42309-.42168-10.77757-1.80215-14.1221-2.08405-4.68265-.39467-14.28993-.18758-17.80807.38387-8.70887 1.41459-13.028171 3.55254-15.811026 7.82606-2.230704 3.42561-3.30745 7.4555-3.304504 12.36763.0032 5.38208 1.685615 10.33001 4.555689 13.39835 1.872987 2.00238 6.082191 3.96008 9.779001 4.54822 2.10281.33454 8.92935.11855 11.56007-.36577z" transform="scale(0.26458333)"/></svg></span></a><button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"><li class=nav-item><a class=nav-link href=https://github.com/aws-controllers-k8s/community><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><span class="ms-2 visually-hidden">GitHub</span></a></li></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav flex-grow-1 main-nav me-auto order-5 order-md-2"><li class="nav-item active"><a class=nav-link href=https://aws-controllers-k8s.github.io/community/docs/community/overview/>Documentation</a></li><li class=nav-item><a class=nav-link href=https://aws-controllers-k8s.github.io/community/reference/>API Reference</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container" role=document><div class=deprecation-banner role=alert><div class=deprecation-icon>&#9888;</div><div class=deprecation-content><strong>This documentation site is deprecated.</strong><p>Please visit the <a href=https://aws-controllers-k8s.github.io/docs>new ACK documentation site</a> for up-to-date information.</p></div></div><style>.deprecation-banner{background:#f8fafc;border:1px solid #cbd5e1;border-left:4px solid #3b82f6;border-radius:4px;padding:12px 16px;margin:0 0 20px;display:flex;align-items:flex-start;gap:10px}.deprecation-banner.deprecation-redirect{border-left-color:#10b981}.deprecation-icon{font-size:18px;line-height:1.4;flex-shrink:0}.deprecation-content{flex:1}.deprecation-content strong{color:#1e293b;font-size:14px}.deprecation-redirect .deprecation-content strong{color:#065f46}.deprecation-content p{margin:4px 0 0;color:#475569;font-size:13px}.deprecation-redirect .deprecation-content p{color:#065f46}.deprecation-content a{color:#2563eb;text-decoration:none;font-weight:500}.deprecation-content a:hover{text-decoration:underline}.dark .deprecation-banner{background:#1e293b;border-color:#475569;border-left-color:#60a5fa}.dark .deprecation-content strong{color:#f1f5f9}.dark .deprecation-content p{color:#94a3b8}.dark .deprecation-content a{color:#60a5fa}.dark .deprecation-banner.deprecation-redirect{border-left-color:#34d399}.dark .deprecation-redirect .deprecation-content strong,.dark .deprecation-redirect .deprecation-content p{color:#a7f3d0}</style><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-introduction aria-expanded=false>
Introduction</button><div class="collapse collapsed" id=section-introduction><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/community/overview/>Overview</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/community/deprecation-policy/>Deprecation Policy</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/community/how-it-works/>How it Works</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/community/services/>Services</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/community/releases/>Release Phases</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-getting-started aria-expanded=false>
Getting Started</button><div class="collapse collapsed" id=section-getting-started><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/user-docs/install/>Install an ACK Controller</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/user-docs/irsa/>Configure IAM Permissions</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/user-docs/features/>Alpha Features</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/user-docs/resource-crud/>Create an ACK Resource</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/user-docs/multi-region-resource-management/>Manage Resources In Multiple Regions</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/user-docs/cross-account-resource-management/>Manage Resources In Multiple AWS Accounts</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/user-docs/drift-recovery/>Recovering from Drift</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/user-docs/leader-election/>Managing multiple instances of ACK with leader election</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/user-docs/authorization/>Permissions Overview</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/user-docs/authentication/>Authentication and Credentials</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/user-docs/field-export/>Copy a resource field into a ConfigMap or Secret</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/user-docs/adopted-resource/>Adopting Existing AWS Resources</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/user-docs/ack-tags/>Managing Tags on your AWS Resources</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/user-docs/deletion-policy/>Retain AWS Resources after CR Deletion</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/user-docs/openshift/>Red Hat OpenShift</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/user-docs/cleanup/>Uninstall an ACK Controller</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded" data-bs-toggle=collapse data-bs-target=#section-tutorials aria-expanded=true>
Tutorials</button><div class="collapse show" id=section-tutorials><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/tutorials/sagemaker-example/>Machine Learning with the ACK SageMaker Controller</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/tutorials/autoscaling-example/>Scale SageMaker Workloads with Application Auto Scaling</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/tutorials/rds-example/>Deploy PostgreSQL, MySQL, MariaDB Instances Using the ACK RDS Controller</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/tutorials/secrets-manager-example/>Create a Secret with AWS Secrets Manager</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/tutorials/ec2-example/>Manage a VPC Workflow with the ACK EC2-Controller</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/tutorials/apigatewayv2-reference-example/>Manage HTTP APIs with the ACK APIGatewayv2 Controller</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/tutorials/lambda-with-secrets-manager/>Pass secrets to Lambda Function with AWS Secrets Manager</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/tutorials/memorydb-example/>Create a managed Amazon MemoryDB for Redis Cluster using the ACK MemoryDB Controller</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/tutorials/aurora-serverless-v2/>Manage an Aurora Serverless v2 cluster with the ACK RDS Controller</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/tutorials/eventbridge-example/>Manage EventBridge event buses and rules with the ACK EventBridge Controller</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/tutorials/pipes-example/>Manage EventBridge Pipes with the ACK Pipes Controller</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/tutorials/sqs-example/>Manage SQS queues with the ACK SQS Controller</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/tutorials/lambda-oci-example/>Create a Lambda OCI Function with the ACK Lambda Controller</a></li><li><a class="docs-link rounded active" href=https://aws-controllers-k8s.github.io/community/docs/tutorials/emr-on-eks-example/>Run Spark jobs using the ACK EMR on EKS controller</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-contributor aria-expanded=false>
Contributor Docs</button><div class="collapse collapsed" id=section-contributor><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/contributor-docs/overview/>Contribution Overview</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/contributor-docs/tenets/>Project Tenets</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/contributor-docs/code-generation/>Code Generation</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/contributor-docs/code-organization/>Code Organization</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/contributor-docs/operatorhub-onboarding/>OperatorHub Onboarding</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/contributor-docs/api-inference/>API Inference</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/contributor-docs/setup/>Setup</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/contributor-docs/building-controller/>Building a Controller</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/contributor-docs/code-generator-config/>Understanding generator.yaml configuration</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/contributor-docs/testing/>Testing</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/contributor-docs/release/>Release</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-discussion aria-expanded=false>
Discussion</button><div class="collapse collapsed" id=section-discussion><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/community/background/>Background</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/community/faq/>FAQ</a></li><li><a class="docs-link rounded" href=https://aws-controllers-k8s.github.io/community/docs/community/discussions/>Discussions</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><hr><span class=small><nav id=TableOfContents><ul><li><a href=#installation-steps>Installation steps</a><ul><li></li></ul></li><li><a href=#install-eks-cluster>Install EKS cluster</a><ul><li></li></ul></li><li><a href=#install-emrcontainers-controller-in-your-eks-cluster>Install emrcontainers-controller in your EKS cluster</a><ul><li></li></ul></li><li><a href=#create-emr-virtualcluster>Create EMR VirtualCluster</a><ul><li></li></ul></li><li><a href=#run-a-sample-spark-job>Run a Sample Spark Job</a></li><li><a href=#cleanup>Cleanup</a></li><li><a href=#limitations>Limitations</a></li><li><a href=#troubleshooting>Troubleshooting</a></li></ul></nav></span></div></nav><main class="docs-content col-lg-11 col-xl-9"><h1>Run Spark jobs using the ACK EMR on EKS controller</h1><p class=lead>Run Spark jobs using ACK service controller for EMR on EKS.</p><p>Using ACK service controller for EMR on EKS, customers have the ability to define and run EMR jobs directly from their Kubernetes clusters. EMR on EKS manages the lifecycle of these jobs and it is <a href=https://aws.amazon.com/blogs/big-data/amazon-emr-on-amazon-eks-provides-up-to-61-lower-costs-and-up-to-68-performance-improvement-for-spark-workloads/>3.5 times faster than open-source Spark</a> because it uses highly optimized EMR runtime</p><p>To get started, you can download the EMR on EKS controller image from <a href=https://gallery.ecr.aws/aws-controllers-k8s/emrcontainers-controller>Amazon ECR</a> and run Spark jobs in minutes. ACK service controller for EMR on EKS is <strong>generally available</strong>. To learn more about EMR on EKS, visit our <a href=https://docs.aws.amazon.com/emr/latest/EMR-on-EKS-DevelopmentGuide/emr-eks.html>documentation</a>.</p><h2 id=installation-steps>Installation steps<a href=#installation-steps class=anchor aria-hidden=true>#</a></h2><p>Here are the steps involved for installing EMR on EKS controller.</p><ol><li><a href=#install-eks-cluster>Install EKS cluster</a></li></ol><ul><li><a href=#create-iam-identity-mapping>Create IAM Identity mapping</a></li></ul><ol start=2><li><a href=#install-emrcontainers-controller-in-your-eks-cluster>Install emrcontainers-controller</a></li></ol><ul><li><a href=#configure-irsa-for-emr-on-eks-controller>Configure IRSA for emr on eks controller</a></li></ul><ol start=3><li><a href=#create-emr-virtualcluster>Create EMR VirtualCluster</a></li></ol><ul><li><a href=#create-job-execution-role>Create EMR Job Execution Role & configure IRSA</a></li></ul><ol start=4><li><a href=#run-a-sample-spark-job>Run a sample job</a></li></ol><h4 id=prereqs>Prereqs<a href=#prereqs class=anchor aria-hidden=true>#</a></h4><p>Install these tools before proceeding:</p><ul><li><a href=https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html>AWS CLI</a></li><li><code>kubectl</code> - <a href=https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/>the Kubernetes CLI</a></li><li><code>eksctl</code> - <a href=https://docs.aws.amazon.com/eks/latest/userguide/eksctl.html>the CLI for AWS EKS</a></li><li><code>yq</code> - <a href=https://github.com/mikefarah/yq>YAML processor</a></li><li><code>helm</code> - <a href=https://helm.sh/docs/intro/install/>the package manager for Kubernetes</a></li></ul><p>Configure AWS CLI with sufficient permissions to install EKS cluster. Please see <a href=https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html>documentation</a> for further guidance</p><h2 id=install-eks-cluster>Install EKS cluster<a href=#install-eks-cluster class=anchor aria-hidden=true>#</a></h2><p>You can either create an EKS cluster or re-use existing one. Below listed are steps for creating new EKS cluster. Let&rsquo;s export environment variables that are needed for the EMR on EKS cluster setup. Please copy and paste commands into terminal for faster provisioning</p><pre><code>export AWS_ACCOUNT_ID=$(aws sts get-caller-identity --query &quot;Account&quot; --output text)
export EKS_CLUSTER_NAME=&quot;ack-emr-eks&quot;
export AWS_REGION=&quot;us-west-2&quot;
</code></pre><p>We&rsquo;ll use eksctl to install EKS cluster.</p><pre><code>eksctl create cluster -f - &lt;&lt; EOF
---
apiVersion: eksctl.io/v1alpha5
kind: ClusterConfig
metadata:
  name: ${EKS_CLUSTER_NAME}
  region: ${AWS_REGION}
  version: &quot;1.23&quot;

managedNodeGroups:
  - instanceType: m5.xlarge
    name: ${EKS_CLUSTER_NAME}-ng
    desiredCapacity: 2

iam:
  withOIDC: true
EOF
</code></pre><h4 id=create-iam-identity-mapping>Create IAM Identity mapping<a href=#create-iam-identity-mapping class=anchor aria-hidden=true>#</a></h4><p>We need to create emr-containers identity in EKS cluster so that EMR service has proper RBAC permissions needed to run and manage Spark jobs</p><pre><code>export EMR_NAMESPACE=emr-ns
echo &quot;creating namespace for $SERVICE&quot;
kubectl create ns $EMR_NAMESPACE

echo &quot;creating iamidentitymapping using eksctl&quot;
eksctl create iamidentitymapping \
   --cluster $EKS_CLUSTER_NAME \
   --namespace $EMR_NAMESPACE \
   --service-name &quot;emr-containers&quot;
</code></pre><p><strong>Expected outcome</strong></p><pre><code>2022-08-26 09:07:42 [ℹ]  created &quot;emr-ns:Role.rbac.authorization.k8s.io/emr-containers&quot;
2022-08-26 09:07:42 [ℹ]  created &quot;emr-ns:RoleBinding.rbac.authorization.k8s.io/emr-containers&quot;
2022-08-26 09:07:42 [ℹ]  adding identity &quot;arn:aws:iam::012345678910:role/AWSServiceRoleForAmazonEMRContainers&quot; to auth ConfigMap
</code></pre><h2 id=install-emrcontainers-controller-in-your-eks-cluster>Install emrcontainers-controller in your EKS cluster<a href=#install-emrcontainers-controller-in-your-eks-cluster class=anchor aria-hidden=true>#</a></h2><p>Now we can go ahead and install EMR on EKS controller. First, let&rsquo;s export environment variables needed for setup</p><pre><code class=language-bash>export SERVICE=emrcontainers
export RELEASE_VERSION=$(curl -sL https://api.github.com/repos/aws-controllers-k8s/${SERVICE}-controller/releases/latest | jq -r '.tag_name | ltrimstr(&quot;v&quot;)')
export ACK_SYSTEM_NAMESPACE=ack-system
</code></pre><p>We cam use Helm for the installation</p><pre><code>echo &quot;installing ack-$SERVICE-controller&quot;
aws ecr-public get-login-password --region us-east-1 | helm registry login --username AWS --password-stdin public.ecr.aws
helm install --create-namespace -n $ACK_SYSTEM_NAMESPACE ack-$SERVICE-controller \
  oci://public.ecr.aws/aws-controllers-k8s/$SERVICE-chart --version=$RELEASE_VERSION --set=aws.region=$AWS_REGION
</code></pre><p><strong>Expected outcome</strong></p><pre><code>NAME: ack-emrcontainers-controller
LAST DEPLOYED: Fri Aug 26 09:05:08 2022
NAMESPACE: ack-system
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
emrcontainers-chart has been installed.
This chart deploys &quot;public.ecr.aws/aws-controllers-k8s/emrcontainers-controller:0.0.6&quot;.

Check its status by running:
  kubectl --namespace ack-system get pods -l &quot;app.kubernetes.io/instance=ack-emrcontainers-controller&quot;

You are now able to create Amazon EMR on EKS (EMRContainers) resources!
</code></pre><h4 id=configure-irsa-for-emr-on-eks-controller>Configure IRSA for emr on eks controller<a href=#configure-irsa-for-emr-on-eks-controller class=anchor aria-hidden=true>#</a></h4><p>Once the controller is deployed, you need to setup IAM permissions for the controller so that it can create and manage resources using EMR, S3 and other API&rsquo;s. We will use <a href=https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html>IAM Roles for Service Account</a> to secure this IAM role so that only EMR on EKS controller service account can assume the permissions assigned.</p><p>Please follow <a href=https://aws-controllers-k8s.github.io/community/docs/user-docs/irsa/>how to configure IAM permissions</a> for IRSA setup. Make sure to change the value for <strong><code>SERVICE</code></strong> to <strong><code>emrcontainers</code></strong></p><p>After completing all the steps, please validate annotation for service account before proceeding.</p><pre><code># validate annotation
kubectl get pods -n $ACK_SYSTEM_NAMESPACE
CONTROLLER_POD_NAME=$(kubectl get pods -n $ACK_SYSTEM_NAMESPACE --selector=app.kubernetes.io/name=emrcontainers-chart -o jsonpath='{.items..metadata.name}')
kubectl describe pod -n $ACK_SYSTEM_NAMESPACE $CONTROLLER_POD_NAME | grep &quot;^\s*AWS_&quot;
</code></pre><p><strong>Expected outcome</strong></p><pre><code>AWS_REGION:                      us-west-2
AWS_ENDPOINT_URL:                
AWS_ROLE_ARN:                    arn:aws:iam::012345678910:role/ack-emrcontainers-controller
AWS_WEB_IDENTITY_TOKEN_FILE:     /var/run/secrets/eks.amazonaws.com/serviceaccount/token (http://eks.amazonaws.com/serviceaccount/token)
</code></pre><h2 id=create-emr-virtualcluster>Create EMR VirtualCluster<a href=#create-emr-virtualcluster class=anchor aria-hidden=true>#</a></h2><p>We can now create EMR Virtual Cluster. An EMR Virtual Cluster is mapped to a Kubernetes namespace. EMR uses virtual clusters to run jobs and host endpoints.</p><pre><code>cat &lt;&lt; EOF &gt; virtualcluster.yaml
---
apiVersion: emrcontainers.services.k8s.aws/v1alpha1
kind: VirtualCluster
metadata:
  name: my-ack-vc
spec:
  name: my-ack-vc
  containerProvider:
    id: $EKS_CLUSTER_NAME
    type_: EKS
    info:
      eksInfo:
        namespace: emr-ns
EOF
</code></pre><p>Let&rsquo;s create a virtualcluster</p><pre><code>envsubst &lt; virtualcluster.yaml | kubectl apply -f -
kubectl describe virtualclusters
</code></pre><p><strong>Expected outcome</strong></p><pre><code>Name:         my-ack-vc
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
API Version:  emrcontainers.services.k8s.aws/v1alpha1
Kind:         VirtualCluster
...
Status:
  Ack Resource Metadata:
    Arn:               arn:aws:emr-containers:us-west-2:012345678910:/virtualclusters/dxnqujbxexzri28ph1wspbxo0
    Owner Account ID:  012345678910
    Region:            us-west-2
  Conditions:
    Last Transition Time:  2022-08-26T17:21:26Z
    Message:               Resource synced successfully
    Reason:                
    Status:                True
    Type:                  ACK.ResourceSynced
  Id:                      dxnqujbxexzri28ph1wspbxo0
Events:                    &lt;none&gt;
</code></pre><h4 id=create-job-execution-role>Create Job Execution Role<a href=#create-job-execution-role class=anchor aria-hidden=true>#</a></h4><p>In order to run sample spark job, we need to create EMR Job Execution Role. This Role will have IAM permissions such as S3, CloudWatch Logs for running your job. We will use IRSA to secure this job role</p><pre><code>ACK_JOB_EXECUTION_ROLE=&quot;ack-${SERVICE}-jobexecution-role&quot;
ACK_JOB_EXECUTION_IAM_ROLE_DESCRIPTION=&quot;IRSA role for ACK ${SERVICE} Job Execution&quot;

cat &lt;&lt;EOF &gt; job_trust.json
{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Sid&quot;: &quot;&quot;,
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Principal&quot;: {
                &quot;Service&quot;: &quot;ec2.amazonaws.com&quot;
            },
            &quot;Action&quot;: &quot;sts:AssumeRole&quot;
        }
    ]
}
EOF
aws iam create-role --role-name &quot;${ACK_JOB_EXECUTION_ROLE}&quot; \
    --assume-role-policy-document file://job_trust.json  \
    --description &quot;${ACK_JOB_EXECUTION_IAM_ROLE_DESCRIPTION}&quot;

export ACK_JOB_EXECUTION_ROLE_ARN=$(aws iam get-role --role-name=$ACK_JOB_EXECUTION_ROLE --query Role.Arn --output text)    
</code></pre><pre><code>cat &lt;&lt;EOF &gt; job_policy.json
{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;s3:PutObject&quot;,
                &quot;s3:GetObject&quot;,
                &quot;s3:ListBucket&quot;
            ],
            &quot;Resource&quot;: &quot;*&quot;
        },
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;s3:ListBucket&quot;,
                &quot;s3:GetObject*&quot;
            ],
            &quot;Resource&quot;: [
                &quot;arn:aws:s3:::tripdata&quot;,
                &quot;arn:aws:s3:::tripdata/*&quot;
            ]
        },
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: [
                &quot;logs:PutLogEvents&quot;,
                &quot;logs:CreateLogStream&quot;,
                &quot;logs:DescribeLogGroups&quot;,
                &quot;logs:DescribeLogStreams&quot;
            ],
            &quot;Resource&quot;: [
                &quot;arn:aws:logs:*:*:*&quot;
            ]
        }
    ]
}
EOF
echo &quot;Creating ACK-${SERVICE}-JobExecution-POLICY&quot;
aws iam create-policy   \
  --policy-name ack-${SERVICE}-jobexecution-policy \
  --policy-document file://job_policy.json

echo -n &quot;Attaching IAM policy ...&quot;
aws iam attach-role-policy \
  --role-name &quot;${ACK_JOB_EXECUTION_ROLE}&quot; \
  --policy-arn &quot;arn:aws:iam::${AWS_ACCOUNT_ID}:policy/ack-${SERVICE}-jobexecution-policy&quot;

aws emr-containers update-role-trust-policy \
  --cluster-name ${EKS_CLUSTER_NAME} \
  --namespace ${EMR_NAMESPACE} \
  --role-name ${ACK_JOB_EXECUTION_ROLE}
</code></pre><h2 id=run-a-sample-spark-job>Run a Sample Spark Job<a href=#run-a-sample-spark-job class=anchor aria-hidden=true>#</a></h2><p>Before running a sample job, let&rsquo;s create CloudWatch Logs and an S3 bucket to store EMR on EKS logs</p><pre><code>export RANDOM_ID1=$(LC_ALL=C tr -dc a-z0-9 &lt;/dev/urandom | head -c 8)

aws logs create-log-group --log-group-name=/emr-on-eks-logs/$EKS_CLUSTER_NAME
aws s3 mb s3://$EKS_CLUSTER_NAME-$RANDOM_ID1
</code></pre><p>Now let&rsquo;s submit sample spark job</p><pre><code>echo &quot;checking if VirtualCluster Status is &quot;True&quot;&quot;
VC=$(kubectl get virtualcluster -o jsonpath='{.items..metadata.name}')
kubectl describe virtualcluster/$VC | yq e '.Status.Conditions.Status'

export RANDOM_ID2=$(LC_ALL=C tr -dc a-z0-9 &lt;/dev/urandom | head -c 8)

cat &lt;&lt; EOF &gt; jobrun.yaml
---
apiVersion: emrcontainers.services.k8s.aws/v1alpha1
kind: JobRun
metadata:
  name: my-ack-jobrun-${RANDOM_ID2}
spec:
  name: my-ack-jobrun-${RANDOM_ID2}
  virtualClusterRef:
    from:
      name: my-ack-vc
  executionRoleARN: &quot;${ACK_JOB_EXECUTION_ROLE_ARN}&quot;
  releaseLabel: &quot;emr-6.7.0-latest&quot;
  jobDriver:
    sparkSubmitJobDriver:
      entryPoint: &quot;local:///usr/lib/spark/examples/src/main/python/pi.py&quot;
      entryPointArguments:
      sparkSubmitParameters: &quot;--conf spark.executor.instances=2 --conf spark.executor.memory=1G --conf spark.executor.cores=1 --conf spark.driver.cores=1&quot;
  configurationOverrides: |
    ApplicationConfiguration: null
    MonitoringConfiguration:
      CloudWatchMonitoringConfiguration:
        LogGroupName: /emr-on-eks-logs/$EKS_CLUSTER_NAME
        LogStreamNamePrefix: pi-job
      S3MonitoringConfiguration:
        LogUri: s3://$EKS_CLUSTER_NAME-$RANDOM_ID1   
EOF
</code></pre><pre><code>echo &quot;running sample job&quot;
kubectl apply -f jobrun.yaml
kubectl describe jobruns
</code></pre><p><strong>Expected outcome</strong></p><pre><code>Name:         my-ack-jobrun-t2rpcpks
Namespace:    default
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
API Version:  emrcontainers.services.k8s.aws/v1alpha1
Kind:         JobRun
...
Status:
  Ack Resource Metadata:
    Arn:               arn:aws:emr-containers:us-west-2:012345678910:/virtualclusters/dxnqujbxexzri28ph1wspbxo0/jobruns/000000030mrd934cdqc
    Owner Account ID:  012345678910
    Region:            us-west-2
  Conditions:
    Last Transition Time:  2022-08-26T18:29:12Z
    Message:               Resource synced successfully
    Reason:                
    Status:                True
    Type:                  ACK.ResourceSynced
  Id:                      000000030mrd934cdqc
Events:                    &lt;none&gt;
</code></pre><h2 id=cleanup>Cleanup<a href=#cleanup class=anchor aria-hidden=true>#</a></h2><p>Simply run these commands to cleanup your environment</p><pre><code># delete all custom resources
kubectl delete -f virtualcluster.yaml
kubectl delete -f jobrun.yaml
# note: you cannot delete jobruns until virtualcluster its mapped to is deleted

# uninstall emrcontainers controller
helm delete ack-$SERVICE-controller -n $ACK_SYSTEM_NAMESPACE

# delete namespace
kubectl delete ns $ACK_SYSTEM_NAMESPACE
kubectl delete ns $EMR_NAMESPACE

# delete aws resources
aws logs delete-log-group --log-group-name=/emr-on-eks-logs/$EKS_CLUSTER_NAME
aws s3 rm s3://$EKS_CLUSTER_NAME-$RANDOM_ID1 --recursive
aws s3 rb s3://$EKS_CLUSTER_NAME-$RANDOM_ID1 

# delete EKS cluster
eksctl delete cluster --name &quot;${EKS_CLUSTER_NAME}&quot;
</code></pre><h2 id=limitations>Limitations<a href=#limitations class=anchor aria-hidden=true>#</a></h2><ul><li>You cannot delete a JobRun unless its in <strong>error</strong> state. There is no delete-job-run API for deleting jobs (for good reason). However, if your JobRun goes into error state, you can run <code>kubectl delete jobrun/&lt;job-run-name></code> to cancel the job.</li></ul><h2 id=troubleshooting>Troubleshooting<a href=#troubleshooting class=anchor aria-hidden=true>#</a></h2><ul><li>If you run into issues creating VirtualCluster or JobRuns, check EMR on EKS controller logs for troubleshooting</li></ul><pre><code>CONTROLLER_POD=$(kubectl get pod -n ${ACK_SYSTEM_NAMESPACE} -o jsonpath='{.items..metadata.name}')
kubectl logs ${CONTROLLER_POD} -n ${ACK_SYSTEM_NAMESPACE}
</code></pre><ul><li>You can enable debug logs for EMR on EKS controller if you are unable to determine cause of the error. You need to change values for <code>enable-development-logging</code> to <code>true</code> and <code>--log-level</code> to <code>debug</code></li></ul><pre><code>CONTROLLER_DEPLOYMENT=$(kubectl get deploy -n ${ACK_SYSTEM_NAMESPACE} -o jsonpath='{.items..metadata.name}')
kubectl edit deploy/${CONTROLLER_DEPLOYMENT} -n ${ACK_SYSTEM_NAMESPACE}
</code></pre><p>This is how your values should look after changes are applied.</p><pre><code>        - --aws-region
        - $(AWS_REGION)
        - --aws-endpoint-url
        - $(AWS_ENDPOINT_URL)
        - --enable-development-logging
        - &quot;true&quot;
        - --log-level
        - debug
        - --resource-tags
        - $(ACK_RESOURCE_TAGS)
</code></pre><ul><li>If you run into any issue, please create <a href=https://github.com/aws-controllers-k8s/community/issues>Github issue</a>. Click <strong>New issue</strong> and select the type of issue, add <code>[emr-containers] &lt;highlevel overview></code> under title, and add enough details so that we can reproduce and provide a response</li></ul><p class=edit-page><a href=https://github.com/aws-controllers-k8s/community/blob/main/docs/content/docs/tutorials/emr-on-eks-example.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></p><div class=my-n3></div></main></div></div></div><footer class="footer mt-auto text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a href=https://gohugo.io/>Hugo</a> and <a href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=https://aws-controllers-k8s.github.io/community/js/bootstrap.min.b215b4cd9b395d6674fe820a7dfe831d833cf64feef865325eb6e3256a4cf84110a040b38af60cdecabe307668c218a83a96ff6f1aa1dade51fc78195449e610.js integrity="sha512-shW0zZs5XWZ0/oIKff6DHYM89k/u+GUyXrbjJWpM+EEQoECzivYM3sq+MHZowhioOpb/bxqh2t5R/HgZVEnmEA==" crossorigin=anonymous defer></script>
<script src=https://aws-controllers-k8s.github.io/community/js/highlight.min.845ac7a35070c98e709cb2c243868ea6535713a4e36512571d6995b58dc2e9710dc129f61e35d985044dea835379d832388bc7449de083d2d1e208bf015920fc.js integrity="sha512-hFrHo1BwyY5wnLLCQ4aOplNXE6TjZRJXHWmVtY3C6XENwSn2HjXZhQRN6oNTedgyOIvHRJ3gg9LR4gi/AVkg/A==" crossorigin=anonymous defer></script>
<script src=https://aws-controllers-k8s.github.io/community/main.min.f2b231c301bb6bb703581a2ab160f506b26c9b58a8321a04bff902e06cf229ac0c6d21eeb75cab5a14e5d6f4dd54753134874d6cab025313d1c9b6e8dbe649b5.js integrity="sha512-8rIxwwG7a7cDWBoqsWD1BrJsm1ioMhoEv/kC4GzyKawMbSHut1yrWhTl1vTdVHUxNIdNbKsCUxPRybbo2+ZJtQ==" crossorigin=anonymous defer></script>
<script src=https://aws-controllers-k8s.github.io/community/index.min.8d63dec3d4b36bca98d7c625bf53341f9657c1e0099df62fa8b3c4030aa5674e4c01ca4548a4e8dfe2497a80aad01d98d7d047a92ca790fdd1898e6191baa501.js integrity="sha512-jWPew9Sza8qY18Ylv1M0H5ZXweAJnfYvqLPEAwqlZ05MAcpFSKTo3+JJeoCq0B2Y19BHqSynkP3RiY5hkbqlAQ==" crossorigin=anonymous defer></script></body></html>